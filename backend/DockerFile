# 1️⃣ Use a slim Python base
FROM python:3.12-slim

# 2️⃣ Set working directory
WORKDIR /app

# 3️⃣ Copy requirements first for caching
COPY requirements.txt .

# 4️⃣ Install CPU-only PyTorch first (smaller image)
RUN pip install --no-cache-dir torch==2.5.1+cpu --index-url https://download.pytorch.org/whl/cpu

# 5️⃣ Install the rest of the dependencies
RUN pip install --no-cache-dir -r requirements.txt

# 6️⃣ Copy the application code
COPY . .

# 7️⃣ Set environment variables for Flask
ENV PORT=8080
ENV FLASK_APP=app.py

# 8️⃣ Run gunicorn as entrypoint
CMD gunicorn -w 1 -b 0.0.0.0:$PORT app:app
